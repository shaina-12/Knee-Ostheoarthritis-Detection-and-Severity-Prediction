{% extends 'base.html' %}
{% block title %}
Diagnosis
{% endblock %}
{% block content %}
<br>
<h2 style="text-align: center; color: rgb(30, 30, 157); font-weight: bold">Diagnosis</h2>
<p style="text-align: center; color:rgb(151, 154, 221); font-weight: bold">Please refer to the instructions given below and upload the X-ray images accordingly to get the result of the diagnosis.</p>
<div class="container">
   <br>
   <h3 style="text-align: justify; color: rgb(108, 50, 202); font-weight: bold">Instructions</h3>
   <br>
   <ul>
      <li>
         <p> Step 1: Creation of metadata by retrieving the path of the image files.</p>
      </li>
      <li>
         <p> Step 2: Resize the images to the size of 256x256 pixels and the performing centre crop to crop the image to the size of 224x224.</p>
      </li>
      <li>
         <p> Step 3: Converting the image to the tensors and performing normalization on it.</p>
      </li>
      <li>
         <p> Step 4: Loading the pre-trained MobileNetV2 model.</p>
      </li>
      <li>
         <p> Step 5: Setting the batch size as 32, and the learning rate as 0.00001, and using the StepLR Scheduler and Adam Optimizer Function and Cross Entropy Loss as a loss function.</p>
      </li>
      <li>
         <p> Step 6: Training the Model to 10 epochs, saving the best model, drawing the training and validation accuracy and loss curve, confusion matrix, and classification report for training and testing data.</p>
      </li>
      <li>
         <p> Step 7: In this project, the detection of knee osteoarthritis and classified its severity levels according to the KL grading system have been performed using the lightweight pre-trained CNN model named MobileNetV2.</p>
      </li>
      <li>
         <p> Step 8: The model is trained on 10 epochs having a batch size of 32 using the Adam optimizer, using Cross-Entropy loss as a loss function and Step Learning Rate Scheduler to monitor and control its learning rate and its accuracy and its weighted precision, recall, and F1 scores are calculated.</p>
      </li>
   </ul>
   <br>
</div>

<form method="POST" enctype="multipart/form-data">
   <div style="display: flex; align-items: center; flex-direction: column;">
      <input type="file" id="image-input" name="file" accept=".jpg,.jpeg,.png" onchange="previewImage()">
      <div style="margin-top: 20px;">
         <img id="image-preview" src="#" alt="Preview" style="display: none; max-width: 300px; max-height: 300px; margin-right: 20px;">
         <button id="predict-btn" type="submit" class="btn btn-primary" style="display: none;">Predict!</button>
      </div>
   </div>
</form>

<br>
<script src="{{ url_for('static', filename='js/main.js') }}" type="text/javascript"></script>
<script>
   function previewImage() {
       var reader = new FileReader();
       reader.onload = function(event) {
           var img = document.getElementById("image-preview");
           var btn = document.getElementById("predict-btn");
           img.src = event.target.result;
           img.style.display = "inline-block";
           btn.style.display = "inline-block";
       };
       reader.readAsDataURL(event.target.files[0]);
   }
</script>
{% endblock %}